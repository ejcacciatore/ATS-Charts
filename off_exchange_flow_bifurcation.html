<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Off-Exchange Flow Bifurcation — August 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Highcharts (for the donut) -->
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <style>
    :root{
      --ink:#0b1b31; --muted:#5b6b7f; --bg:#f5f7fb; --line:#e6ecf5;
      --accent:#1f62ff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:28px; font:14px/1.5 system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, sans-serif;
      color:var(--ink); background:#fff;
    }
    .wrap{max-width:1000px; margin:0 auto}
    h1{margin:0; font-size:28px; text-align:center}
    .sub{margin:4px 0 18px; text-align:center; color:var(--muted); font-style:italic}
    .panel{
      background:#fff; border:1px solid var(--line); border-radius:14px; overflow:hidden;
      box-shadow:0 6px 22px rgba(15,25,40,.06);
    }
    table{width:100%; border-collapse:collapse}
    thead th{
      background:var(--bg); color:var(--muted); font-weight:600; text-transform:none;
      letter-spacing:.2px; font-size:13px; padding:14px 16px; text-align:left; border-bottom:1px solid var(--line);
    }
    tbody td{padding:16px; border-bottom:1px solid var(--line); vertical-align:top}
    tbody tr:last-child td{border-bottom:0}
    .kpis{display:grid; grid-template-columns:repeat(3,1fr); gap:14px; margin:16px 0 6px}
    .kpi{
      background:var(--bg); border-radius:12px; padding:14px 12px; text-align:center; border:1px solid var(--line)
    }
    .kpi small{display:block; color:var(--muted); font-weight:600; letter-spacing:.3px}
    .kpi b{display:block; font-size:22px; margin-top:2px}
    .foot{color:var(--muted); font-size:12px; margin-top:10px; text-align:right}
    .grid{display:grid; grid-template-columns:1.4fr .9fr; gap:18px; align-items:stretch; margin-top:18px}
    .card{background:#fff; border:1px solid var(--line); border-radius:14px; padding:12px}
    .label{color:var(--muted); font-weight:600; font-size:12px; letter-spacing:.3px}
    .badge{
      display:inline-block; background:rgba(31,98,255,.08); color:var(--accent);
      padding:4px 8px; border-radius:999px; font-weight:700; font-size:12px; vertical-align:middle
    }
    .btns{display:flex; gap:8px; justify-content:flex-end; margin-top:6px}
    button{
      background:#fff; color:var(--ink); border:1px solid var(--line); border-radius:10px;
      padding:8px 12px; cursor:pointer
    }
    button:hover{border-color:#cfd9ea}
    @media (max-width:800px){
      .grid{grid-template-columns:1fr}
      .kpis{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Off-Exchange Flow Bifurcation</h1>
    <div class="sub">Institutional dark pools vs. retail wholesalers — August 2025 estimates</div>

    <!-- KPI strip -->
    <div class="kpis">
      <div class="kpi"><small>OFF-EXCHANGE SHARE</small><b>51%</b></div>
      <div class="kpi"><small>INSTITUTIONAL SHARE OF OFF-EXCHANGE</small><b>22.3%</b></div>
      <div class="kpi"><small>RETAIL SHARE OF OFF-EXCHANGE</small><b>77.7%</b></div>
    </div>

    <div class="grid">
      <!-- Table -->
      <div class="panel">
        <table>
          <thead>
            <tr>
              <th>Segment</th>
              <th>Monthly Volume (Shares B)</th>
              <th>Share of Off-Exchange</th>
              <th>Share of Total Market</th>
              <th>Competitive Focus</th>
            </tr>
          </thead>
          <tbody id="tbl-body">
            <!-- populated by JS -->
          </tbody>
        </table>
      </div>

      <!-- Donut -->
      <div class="card">
        <div class="label" style="margin:2px 0 10px;">
          Off-Exchange Composition <span class="badge" id="offBadge">51% of total</span>
        </div>
        <div id="donut" style="height:300px;"></div>
        <div class="btns">
          <button id="dlPNG">Download PNG</button>
          <button id="dlSVG">Download SVG</button>
        </div>
      </div>
    </div>

    <div class="foot">Source: August 2025 market landscape analysis, estimated using CBOE Advantage Data and FINRA ATS data.</div>
  </div>

  <script>
    // ---------- Data (edit here) ----------
    const TOTAL_MARKET_VOL_B = 374.5;      // billions of shares (contextual)
    const OFF_EX_TOTAL_PCT   = 51.0;       // off-exchange share of total
    const rows = [
      {
        segment: "Institutional ATSs",
        volumeB: 42.4,
        shareOffExchangePct: 22.3,         // % of off-exchange
        shareTotalPct: 11.2,
        focus: "Matching precision, timing determinism, adverse-selection control"
      },
      {
        segment: "Retail Wholesalers",
        volumeB: 148.1,
        shareOffExchangePct: 77.7,
        shareTotalPct: 38.8,
        focus: "Price improvement, internalization efficiency on small-lot flow"
      }
    ];
    // -------------------------------------

    // Build table
    const tbody = document.getElementById('tbl-body');
    rows.forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${r.segment}</td>
        <td>${r.volumeB.toFixed(1)}</td>
        <td>${r.shareOffExchangePct.toFixed(1)} %</td>
        <td>${r.shareTotalPct.toFixed(1)} %</td>
        <td>${r.focus}</td>`;
      tbody.appendChild(tr);
    });
    // Update badge
    document.getElementById('offBadge').textContent = `${OFF_EX_TOTAL_PCT}% of total`;

    // Highcharts donut
    const chart = Highcharts.chart('donut', {
      chart: { type: 'pie', spacing: [8,8,8,8] },
      title: { text: null },
      tooltip: {
        pointFormat: '<b>{point.y:.1f}%</b> of off-exchange'
      },
      plotOptions: {
        pie: {
          innerSize: '60%',
          dataLabels: {
            enabled: true,
            format: '{point.name}<br><b>{point.y:.1f}%</b>',
            distance: 10,
            style: { textOutline: 'none' }
          }
        }
      },
      series: [{
        name: 'Off-Ex Split',
        data: [
          { name:'Institutional ATSs', y: rows[0].shareOffExchangePct },
          { name:'Retail Wholesalers', y: rows[1].shareOffExchangePct }
        ]
      }],
      credits: { enabled:false },
      exporting: { enabled:true }
    });

    // Export buttons (use Highcharts exporting)
    document.getElementById('dlPNG').onclick = ()=> chart.exportChart({ type:'image/png' });
    document.getElementById('dlSVG').onclick = ()=> chart.exportChart({ type:'image/svg+xml' });
  </script>
</body>
</html>
